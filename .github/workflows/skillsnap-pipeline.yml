name: SkillSnap CI/CD Pipeline

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-server:
    name: ğŸ”§ Build & Test SkillSnap API
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3

    - name: ğŸ§° Setup .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: ğŸ“¦ Restore dependencies (API)
      run: dotnet restore SkillSnap.Api/SkillSnap.Api.csproj

    - name: ğŸ”¨ Build API
      run: dotnet build SkillSnap.Api/SkillSnap.Api.csproj --configuration Release

    - name: ğŸ§ª Run API tests
      run: |
        if [ -d "SkillSnap.Tests" ]; then
          dotnet test SkillSnap.Tests/SkillSnap.Tests.csproj --no-build --verbosity normal
        else
          echo "âš ï¸ No tests found. Skipping..."
        fi

  build-client:
    name: ğŸ¨ Build SkillSnap Blazor Client
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3

    - name: ğŸ§° Setup .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: ğŸ“¦ Restore dependencies (Client)
      run: dotnet restore SkillSnap.Client/SkillSnap.Client.csproj

    - name: ğŸ”¨ Build Blazor Client
      run: dotnet build SkillSnap.Client/SkillSnap.Client.csproj --configuration Release

    - name: ğŸŒ Publish Blazor Client
      run: dotnet publish SkillSnap.Client/SkillSnap.Client.csproj -c Release -o release/

    - name: âœ… Check release contents
      run: ls -la release/

    - name: ğŸ“¤ Upload client artifact
      uses: actions/upload-artifact@v4
      with:
        name: SkillSnap-Client
        path: release/
        overwrite: true



